<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Brochure</title>
  <meta name="description" content="Scroll through the brochure pages.">
  <meta name="robots" content="noindex,nofollow,noarchive">
  <style>
    :root{
      /* Hotspot position (percentages of the last page image box) */
      --hotspot-top: 53.5%;
      --hotspot-left: 66%;
      --hotspot-width: 28%;
      --hotspot-height: 6%;
    }

    html, body {
      margin:0;
      height:100%;
      background:#fff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:#111;
    }

    /* HORIZONTAL SCROLLER */
    main {
      height: 100svh;
      display: flex;
      overflow-x: auto;
      overflow-y: hidden;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }
    .slide {
      flex: 0 0 100vw;
      height: 100svh;
      scroll-snap-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      user-select: none;
    }
    .imgbox {
      position: relative;
      display: inline-block;
      line-height: 0;
    }
    /* Preserve aspect ratio – scale to fit both viewport width/height */
    img {
      display: block;
      max-width: 100vw;
      max-height: 100svh;
      width: auto;
      height: auto;
    }

    /* Email hotspot (only on last page) */
    .hotspot {
      position: absolute;
      z-index: 2;
      top: var(--hotspot-top);
      left: var(--hotspot-left);
      width: var(--hotspot-width);
      height: var(--hotspot-height);
      display: block;
      text-decoration: none;
    }

    /* Optional nav buttons */
    .nav {
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
      width: 42px;
      height: 42px;
      border: 0;
      border-radius: 50%;
      background: rgba(0,0,0,.5);
      color: #fff;
      cursor: pointer;
      z-index: 5;
    }
    .nav:focus { outline: 2px solid #fff; outline-offset: 2px; }
    .nav.prev { left: 10px; }
    .nav.next { right: 10px; }

    /* Passcode gate */
    #gate{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#fff;z-index:10}
    #gate form{display:grid;gap:.75rem;padding:1.25rem;border:1px solid #eee;border-radius:12px;box-shadow:0 6px 30px rgba(0,0,0,.06);max-width:28rem;width:90%}
    #gate h1{margin:0;font:600 1.1rem/1.3 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif}
    #gate input{padding:.7rem .9rem;border:1px solid #ddd;border-radius:10px;font:16px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif}
    #gate button{border:0;border-radius:10px;padding:.7rem .9rem;background:#111;color:#fff;font:600 1rem/1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;cursor:pointer}
    .shake{animation:s .24s linear 1}@keyframes s{25%{transform:translateX(4px)}50%{transform:translateX(-4px)}75%{transform:translateX(3px)}}
  </style>
</head>
<body>
  <button class="nav prev" aria-label="Previous page">‹</button>
  <button class="nav next" aria-label="Next page">›</button>

  <main id="rail" aria-label="Brochure pages"></main>

  <!-- passcode gate -->
  <div id="gate" role="dialog" aria-modal="true">
    <form onsubmit="return false">
      <h1>Enter access code</h1>
      <input id="code" type="password" autocomplete="off" placeholder="Access code">
      <button id="go">Unlock</button>
    </form>
  </div>

  <script>
    // Content
    const PAGES = 8;
    const EMAIL = "itvstudiosbovingdon@itv.com";

    // SHA-256('bov123')
    const PASSHASH = "28a042cac135d5e854bd3aec49011c2c8eb0e8c4fc739a101c587fc2fba83ba5";

    // Gate
    const gate = document.getElementById('gate');
    const code = document.getElementById('code');
    const go   = document.getElementById('go');
    if (sessionStorage.getItem('ok')==='1') gate.style.display='none';
    async function unlock(){
      const v = code.value.trim(); if(!v) return;
      const d = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(v));
      const hex = [...new Uint8Array(d)].map(b=>b.toString(16).padStart(2,'0')).join('');
      if(hex===PASSHASH){ sessionStorage.setItem('ok','1'); gate.style.display='none'; }
      else { gate.firstElementChild.classList.remove('shake'); void gate.firstElementChild.offsetWidth; gate.firstElementChild.classList.add('shake'); code.select(); }
    }
    go.addEventListener('click', unlock);
    code.addEventListener('keydown', e => (e.key==='Enter') && unlock());

    // Build horizontal slides
    const rail = document.getElementById('rail');
    function pictureHTML(i, root){
      const base = root ? '' : 'assets/pages/';
      return `
        <source type="image/webp"
                srcset="${base}page-${i}-800.webp 800w,
                        ${base}page-${i}-1200.webp 1200w,
                        ${base}page-${i}-2000.webp 2000w"
                sizes="100vw">
        <img
          src="${base}page-${i}-1200.webp"
          srcset="${base}page-${i}-800.webp 800w,
                  ${base}page-${i}-1200.webp 1200w,
                  ${base}page-${i}-2000.webp 2000w"
          sizes="100vw"
          alt="Brochure page ${i}"
          ${i === 1 ? 'loading="eager"' : 'loading="lazy"'}
          decoding="async">`;
    }
    function buildSlide(i, root){
      const slide = document.createElement('section');
      slide.className = 'slide';
      const box = document.createElement('div');
      box.className = 'imgbox';
      const pic = document.createElement('picture');
      pic.innerHTML = pictureHTML(i, root);
      box.appendChild(pic);

      if (i === PAGES) {
        const a = document.createElement('a');
        a.href = `mailto:${EMAIL}`;
        a.className = 'hotspot';
        a.setAttribute('aria-label', `Email us: ${EMAIL}`);
        a.addEventListener('click', e => e.stopPropagation()); // don't trigger next
        box.appendChild(a);
      }

      slide.appendChild(box);
      // click/tap anywhere to go next (except last)
      if (i < PAGES) slide.addEventListener('click', () => goto(i+1));
      return slide;
    }
    function goto(n){
      const el = rail.children[n-1];
      if (el) el.scrollIntoView({behavior:'smooth', inline:'center', block:'nearest'});
    }

    for (let i = 1; i <= PAGES; i++) {
      let slide = buildSlide(i, false);
      const img = slide.querySelector('img');
      img.addEventListener('error', () => {
        const alt = buildSlide(i, true);
        rail.replaceChild(alt, slide);
        slide = alt;
      }, { once: true });
      rail.appendChild(slide);
    }

    // Arrow keys and buttons
    function currentIndex(){
      const boxes = [...rail.children];
      const mid = window.innerWidth/2;
      let idx = 0, best = Infinity;
      for (let i=0;i<boxes.length;i++){
        const r = boxes[i].getBoundingClientRect();
        const c = r.left + r.width/2;
        const d = Math.abs(c - mid);
        if (d < best){ best = d; idx = i; }
      }
      return idx;
    }
    function prev(){ const i = currentIndex(); goto(Math.max(1, i)); }
    function next(){ const i = currentIndex(); goto(Math.min(PAGES, i+2)); }

    document.querySelector('.nav.prev').addEventListener('click', e => { e.stopPropagation(); prev(); });
    document.querySelector('.nav.next').addEventListener('click', e => { e.stopPropagation(); next(); });
    window.addEventListener('keydown', e => {
      if (e.key === 'ArrowLeft') prev();
      if (e.key === 'ArrowRight') next();
    });
  </script>
</body>
</html>
